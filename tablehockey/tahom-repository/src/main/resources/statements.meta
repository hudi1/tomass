
INSERT_FINAL_STANDING(CRUD,in=FinalStanding,out=FinalStanding,tab=finalStanding)=
  insert into %%final_standing (%ID, %PARTICIPANT_ID, %FINAL_RANK)
  {= values (:id(seq=FINAL_STANDING), :participant.id, :finalRank) }
;

GET_FINAL_STANDING(CRUD,in=FinalStanding,out=FinalStanding,tab=finalStanding=f,tab=participant=p)=
  select %f.ID @id(id), %f.PARTICIPANT_ID @participant.id(id), %f.FINAL_RANK @finalRank
         {? :participant(call=toInit) | , %p.TOURNAMENT_ID @participant.tournament.id, %p.PLAYER_ID @participant.player.id }
  from %%final_standing f
  {? :participant(call=toInit) | left join %%participant p on %f.PARTICIPANT_ID = %p.ID }
  {= where
    {& %f.ID ::= :id }
    {& %f.PARTICIPANT_ID ::= :participant.id }
    {& %f.FINAL_RANK ::= :finalRank }
  }
;

UPDATE_FINAL_STANDING(CRUD,in=FinalStanding,out=FinalStanding,tab=finalStanding)=
  update %%final_standing
  {= set
    { ,%PARTICIPANT_ID = :participant.id(call=isDef) }
    { ,%FINAL_RANK = :finalRank(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_FINAL_STANDING(CRUD,in=FinalStanding,out=FinalStanding,tab=finalStanding)=
  delete from %%final_standing
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_FINAL_STANDING(QRY,in=FinalStanding,out=FinalStanding,tab=finalStanding=f,tab=participant=p)=
  select {? :onlyIds_ | %f.ID @id(id) |
    %f.ID @id(id), %f.PARTICIPANT_ID @participant.id(id), %f.FINAL_RANK @finalRank
    {? :participant(call=toInit) | , %p.TOURNAMENT_ID @participant.tournament.id, %p.PLAYER_ID @participant.player.id }
  }
  from %%final_standing f
  {? :participant(call=toInit) | left join %%participant p on %f.PARTICIPANT_ID = %p.ID }
  {= where
    {& %f.ID ::= :id }
    {& %f.PARTICIPANT_ID ::= :participant.id }
    {& %f.FINAL_RANK ::= :finalRank }
    {& %f.ID in :ids_ }
  }
  {#ID order by %f.ID }
  {#PARTICIPANT order by %f.PARTICIPANT_ID }
  {#FINAL_RANK order by %f.FINAL_RANK }
;

INSERT_GAME(CRUD,in=Game,out=Game,tab=game)=
  insert into %%game (%ID, %HOME_GROUP_PARTICIPANT_ID, %AWAY_GROUP_PARTICIPANT_ID, %RESULT, %STATUS)
  {= values (:id(seq=GAME), :homeGroupParticipant.id, :awayGroupParticipant.id, :result(type=result), :status) }
;

GET_GAME(CRUD,in=Game,out=Game,tab=game=g,tab=groupParticipant=g2,tab=groupParticipant=g1,tab=matchs=m)=
  select %g.ID @id(id), %g.HOME_GROUP_PARTICIPANT_ID @homeGroupParticipant.id(id), %g.AWAY_GROUP_PARTICIPANT_ID @awayGroupParticipant.id(id), %g.RESULT @result(type=result), %g.STATUS @status
         {? :awayGroupParticipant(call=toInit) | , %g2.GROUP_ID @awayGroupParticipant.group.id, %g2.PARTICIPANT_ID @awayGroupParticipant.participant.id, %g2.POINTS @awayGroupParticipant.points, %g2.SCORE @awayGroupParticipant.score(type=score), %g2.RANK @awayGroupParticipant.rank, %g2.SECONDARY_RANK @awayGroupParticipant.secondaryRank }
         {? :homeGroupParticipant(call=toInit) | , %g1.GROUP_ID @homeGroupParticipant.group.id, %g1.PARTICIPANT_ID @homeGroupParticipant.participant.id, %g1.POINTS @homeGroupParticipant.points, %g1.SCORE @homeGroupParticipant.score(type=score), %g1.RANK @homeGroupParticipant.rank, %g1.SECONDARY_RANK @homeGroupParticipant.secondaryRank }
         {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
  from %%game g
  {? :awayGroupParticipant(call=toInit) | left join %%group_participant g2 on %g.AWAY_GROUP_PARTICIPANT_ID = %g2.ID }
  {? :homeGroupParticipant(call=toInit) | left join %%group_participant g1 on %g.HOME_GROUP_PARTICIPANT_ID = %g1.ID }
  {? :matchs(call=toInit) | left join %%matchs m on %g.ID = %m.GAME_ID }
  {= where
    {& %g.ID ::= :id }
    {& %g.HOME_GROUP_PARTICIPANT_ID ::= :homeGroupParticipant.id }
    {& %g.AWAY_GROUP_PARTICIPANT_ID ::= :awayGroupParticipant.id }
    {& %g.RESULT ::= :result(type=result) }
    {& %g.STATUS ::= :status }
  }
;

UPDATE_GAME(CRUD,in=Game,out=Game,tab=game)=
  update %%game
  {= set
    { ,%HOME_GROUP_PARTICIPANT_ID = :homeGroupParticipant.id(call=isDef) }
    { ,%AWAY_GROUP_PARTICIPANT_ID = :awayGroupParticipant.id(call=isDef) }
    { ,%RESULT = :result(type=result,call=isDef) }
    { ,%STATUS = :status(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_GAME(CRUD,in=Game,out=Game,tab=game)=
  delete from %%game
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_GAME(QRY,in=Game,out=Game,tab=game=g,tab=groupParticipant=g2,tab=groupParticipant=g1,tab=matchs=m)=
  select {? :onlyIds_ | %g.ID @id(id) |
    %g.ID @id(id), %g.HOME_GROUP_PARTICIPANT_ID @homeGroupParticipant.id(id), %g.AWAY_GROUP_PARTICIPANT_ID @awayGroupParticipant.id(id), %g.RESULT @result(type=result), %g.STATUS @status
    {? :awayGroupParticipant(call=toInit) | , %g2.GROUP_ID @awayGroupParticipant.group.id, %g2.PARTICIPANT_ID @awayGroupParticipant.participant.id, %g2.POINTS @awayGroupParticipant.points, %g2.SCORE @awayGroupParticipant.score(type=score), %g2.RANK @awayGroupParticipant.rank, %g2.SECONDARY_RANK @awayGroupParticipant.secondaryRank }
    {? :homeGroupParticipant(call=toInit) | , %g1.GROUP_ID @homeGroupParticipant.group.id, %g1.PARTICIPANT_ID @homeGroupParticipant.participant.id, %g1.POINTS @homeGroupParticipant.points, %g1.SCORE @homeGroupParticipant.score(type=score), %g1.RANK @homeGroupParticipant.rank, %g1.SECONDARY_RANK @homeGroupParticipant.secondaryRank }
    {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
  }
  from %%game g
  {? :awayGroupParticipant(call=toInit) | left join %%group_participant g2 on %g.AWAY_GROUP_PARTICIPANT_ID = %g2.ID }
  {? :homeGroupParticipant(call=toInit) | left join %%group_participant g1 on %g.HOME_GROUP_PARTICIPANT_ID = %g1.ID }
  {? :matchs(call=toInit) | left join %%matchs m on %g.ID = %m.GAME_ID }
  {= where
    {& %g.ID ::= :id }
    {& %g.HOME_GROUP_PARTICIPANT_ID ::= :homeGroupParticipant.id }
    {& %g.AWAY_GROUP_PARTICIPANT_ID ::= :awayGroupParticipant.id }
    {& %g.RESULT ::= :result(type=result) }
    {& UPPER(%g.STATUS) like :+status }
    {& %g.ID in :ids_ }
  }
  {#ID order by %g.ID }
  {#HOME_GROUP_PARTICIPANT order by %g.HOME_GROUP_PARTICIPANT_ID }
  {#AWAY_GROUP_PARTICIPANT order by %g.AWAY_GROUP_PARTICIPANT_ID }
;

INSERT_GROUP_PARTICIPANT(CRUD,in=GroupParticipant,out=GroupParticipant,tab=groupParticipant)=
  insert into %%group_participant (%ID, %GROUP_ID, %PARTICIPANT_ID, %POINTS, %SCORE, %RANK, %SECONDARY_RANK)
  {= values (:id(seq=GROUP_PARTICIPANT), :group.id, :participant.id, :points, :score(type=score), :rank, :secondaryRank) }
;

GET_GROUP_PARTICIPANT(CRUD,in=GroupParticipant,out=GroupParticipant,tab=groupParticipant=g,tab=game=g2,tab=groups=g1,tab=participant=p)=
  select %g.ID @id(id), %g.GROUP_ID @group.id(id), %g.PARTICIPANT_ID @participant.id(id), %g.POINTS @points, %g.SCORE @score(type=score), %g.RANK @rank, %g.SECONDARY_RANK @secondaryRank
         {? :games(call=toInit) | , %g2.ID @games.id(id), %g2.HOME_GROUP_PARTICIPANT_ID @games.homeGroupParticipant.id, %g2.AWAY_GROUP_PARTICIPANT_ID @games.awayGroupParticipant.id, %g2.RESULT @games.result(type=result), %g2.STATUS @games.status }
         {? :group(call=toInit) | , %g1.NAME @group.name, %g1.STAGE_ID @group.stage.id }
         {? :participant(call=toInit) | , %p.TOURNAMENT_ID @participant.tournament.id, %p.PLAYER_ID @participant.player.id }
  from %%group_participant g
  {? :games(call=toInit) | left join %%game g2 on %g.ID = %g2.HOME_GROUP_PARTICIPANT_ID }
  {? :group(call=toInit) | left join %%groups g1 on %g.GROUP_ID = %g1.ID }
  {? :participant(call=toInit) | left join %%participant p on %g.PARTICIPANT_ID = %p.ID }
  {= where
    {& %g.ID ::= :id }
    {& %g.GROUP_ID ::= :group.id }
    {& %g.PARTICIPANT_ID ::= :participant.id }
    {& %g.POINTS ::= :points }
    {& %g.SCORE ::= :score(type=score) }
    {& %g.RANK ::= :rank }
    {& %g.SECONDARY_RANK ::= :secondaryRank }
  }
;

UPDATE_GROUP_PARTICIPANT(CRUD,in=GroupParticipant,out=GroupParticipant,tab=groupParticipant)=
  update %%group_participant
  {= set
    { ,%GROUP_ID = :group.id(call=isDef) }
    { ,%PARTICIPANT_ID = :participant.id(call=isDef) }
    { ,%POINTS = :points(call=isDef) }
    { ,%SCORE = :score(type=score,call=isDef) }
    { ,%RANK = :rank(call=isDef) }
    { ,%SECONDARY_RANK = :secondaryRank(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_GROUP_PARTICIPANT(CRUD,in=GroupParticipant,out=GroupParticipant,tab=groupParticipant)=
  delete from %%group_participant
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_GROUP_PARTICIPANT(QRY,in=GroupParticipant,out=GroupParticipant,tab=groupParticipant=g,tab=game=g2,tab=groups=g1,tab=participant=p)=
  select {? :onlyIds_ | %g.ID @id(id) |
    %g.ID @id(id), %g.GROUP_ID @group.id(id), %g.PARTICIPANT_ID @participant.id(id), %g.POINTS @points, %g.SCORE @score(type=score), %g.RANK @rank, %g.SECONDARY_RANK @secondaryRank
    {? :games(call=toInit) | , %g2.ID @games.id(id), %g2.HOME_GROUP_PARTICIPANT_ID @games.homeGroupParticipant.id, %g2.AWAY_GROUP_PARTICIPANT_ID @games.awayGroupParticipant.id, %g2.RESULT @games.result(type=result), %g2.STATUS @games.status }
    {? :group(call=toInit) | , %g1.NAME @group.name, %g1.STAGE_ID @group.stage.id }
    {? :participant(call=toInit) | , %p.TOURNAMENT_ID @participant.tournament.id, %p.PLAYER_ID @participant.player.id }
  }
  from %%group_participant g
  {? :games(call=toInit) | left join %%game g2 on %g.ID = %g2.HOME_GROUP_PARTICIPANT_ID }
  {? :group(call=toInit) | left join %%groups g1 on %g.GROUP_ID = %g1.ID }
  {? :participant(call=toInit) | left join %%participant p on %g.PARTICIPANT_ID = %p.ID }
  {= where
    {& %g.ID ::= :id }
    {& %g.GROUP_ID ::= :group.id }
    {& %g.PARTICIPANT_ID ::= :participant.id }
    {& %g.POINTS ::= :points }
    {& %g.SCORE ::= :score(type=score) }
    {& %g.RANK ::= :rank }
    {& %g.SECONDARY_RANK ::= :secondaryRank }
    {& %g.ID in :ids_ }
  }
  {#ID order by %g.ID }
  {#GROUP order by %g.GROUP_ID }
  {#PARTICIPANT order by %g.PARTICIPANT_ID }
  {#RANK order by %g.RANK }
;

INSERT_GROUPS(CRUD,in=Groups,out=Groups,tab=groups)=
  insert into %%groups (%ID, %NAME, %STAGE_ID)
  {= values (:id(seq=GROUPS), :name, :stage.id) }
;

GET_GROUPS(CRUD,in=Groups,out=Groups,tab=groups=g,tab=groupParticipant=g1,tab=matchs=m,tab=stage=s)=
  select %g.ID @id(id), %g.NAME @name, %g.STAGE_ID @stage.id(id)
         {? :groupParticipants(call=toInit) | , %g1.ID @groupParticipants.id(id), %g1.GROUP_ID @groupParticipants.group.id, %g1.PARTICIPANT_ID @groupParticipants.participant.id, %g1.POINTS @groupParticipants.points, %g1.SCORE @groupParticipants.score(type=score), %g1.RANK @groupParticipants.rank, %g1.SECONDARY_RANK @groupParticipants.secondaryRank }
         {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
         {? :stage(call=toInit) | , %s.NAME @stage.name, %s.SEQUENCE @stage.sequence, %s.NUMBER_OF_HOCKEY @stage.numberOfHockey, %s.WIN_POINTS @stage.winPoints, %s.TYPE @stage.type, %s.TOURNAMENT_ID @stage.tournament.id, %s.STATUS @stage.status, %s.COPY_RESULT_STAGE_ID @stage.copyResultStage.id }
  from %%groups g
  {? :groupParticipants(call=toInit) | left join %%group_participant g1 on %g.ID = %g1.GROUP_ID }
  {? :matchs(call=toInit) | left join %%matchs m on %g.ID = %m.GROUP_ID }
  {? :stage(call=toInit) | left join %%stage s on %g.STAGE_ID = %s.ID }
  {= where
    {& %g.ID ::= :id }
    {& %g.NAME ::= :name }
    {& %g.STAGE_ID ::= :stage.id }
  }
;

UPDATE_GROUPS(CRUD,in=Groups,out=Groups,tab=groups)=
  update %%groups
  {= set
    { ,%NAME = :name }
    { ,%STAGE_ID = :stage.id }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_GROUPS(CRUD,in=Groups,out=Groups,tab=groups)=
  delete from %%groups
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_GROUPS(QRY,in=Groups,out=Groups,tab=groups=g,tab=groupParticipant=g1,tab=matchs=m,tab=stage=s)=
  select {? :onlyIds_ | %g.ID @id(id) |
    %g.ID @id(id), %g.NAME @name, %g.STAGE_ID @stage.id(id)
    {? :groupParticipants(call=toInit) | , %g1.ID @groupParticipants.id(id), %g1.GROUP_ID @groupParticipants.group.id, %g1.PARTICIPANT_ID @groupParticipants.participant.id, %g1.POINTS @groupParticipants.points, %g1.SCORE @groupParticipants.score(type=score), %g1.RANK @groupParticipants.rank, %g1.SECONDARY_RANK @groupParticipants.secondaryRank }
    {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
    {? :stage(call=toInit) | , %s.NAME @stage.name, %s.SEQUENCE @stage.sequence, %s.NUMBER_OF_HOCKEY @stage.numberOfHockey, %s.WIN_POINTS @stage.winPoints, %s.TYPE @stage.type, %s.TOURNAMENT_ID @stage.tournament.id, %s.STATUS @stage.status, %s.COPY_RESULT_STAGE_ID @stage.copyResultStage.id }
  }
  from %%groups g
  {? :groupParticipants(call=toInit) | left join %%group_participant g1 on %g.ID = %g1.GROUP_ID }
  {? :matchs(call=toInit) | left join %%matchs m on %g.ID = %m.GROUP_ID }
  {? :stage(call=toInit) | left join %%stage s on %g.STAGE_ID = %s.ID }
  {= where
    {& %g.ID ::= :id }
    {& UPPER(%g.NAME) like :+name }
    {& %g.STAGE_ID ::= :stage.id }
    {& %g.ID in :ids_ }
  }
  {#ID order by %g.ID }
  {#NAME order by %g.NAME }
  {#STAGE order by %g.STAGE_ID }
;

INSERT_ITHF_TOURNAMENT(CRUD,in=IthfTournament,out=IthfTournament,tab=ithfTournament)=
  insert into %%ithf_tournament (%ID, %PLAYER_ID, %NAME, %SERIES, %DATE, %POINTS, %RANK)
  {= values (:id(seq=ITHF_TOURNAMENT), :player.id, :name, :series(type=series), :date(type=localdate), :points, :rank) }
;

GET_ITHF_TOURNAMENT(CRUD,in=IthfTournament,out=IthfTournament,tab=ithfTournament=i,tab=player=p,tab=user=u)=
  select %i.ID @id(id), %i.PLAYER_ID @player.id(id), %i.NAME @name, %i.SERIES @series(type=series), %i.DATE @date(type=localdate), %i.POINTS @points, %i.RANK @rank
         {? :player(call=toInit) | , %u.PLAYER_ID @player(gtype=user)id(id), %u.EMAIL @player.email, %u.LOGIN @player.login, %u.PASSWORD @player.password, %u.PHONE @player.phone, %u.ROLE @player.role, %u.VALIDITY @player.validity, %p.NAME @player.name, %p.SURNAME @player.surname(type=surname), %p.NICKNAME @player.nickname, %p.GENDER @player.gender, %p.DATE_OF_BIRTH @player.dateOfBirth(type=localdate), %p.COUNTRY @player.country, %p.CITY @player.city, %p.CLUB @player.club, %p.WORLD_RANKING @player.worldRanking, %p.ITHF_ID @player.ithfId, %p.NAME_ASCII @player.nameAscii, %p.SURNAME_ASCII @player.surnameAscii, %p.VERIFICATION @player.verification }
  from %%ithf_tournament i
  {? :player(call=toInit) | left join %%player p on %i.PLAYER_ID = %p.ID left join %%user u on %p.ID = %u.PLAYER_ID }
  {= where
    {& %i.ID ::= :id }
    {& %i.PLAYER_ID ::= :player.id }
    {& %i.NAME ::= :name }
    {& %i.SERIES ::= :series(type=series) }
    {& %i.DATE ::= :date(type=localdate) }
    {& %i.POINTS ::= :points }
    {& %i.RANK ::= :rank }
  }
;

UPDATE_ITHF_TOURNAMENT(CRUD,in=IthfTournament,out=IthfTournament,tab=ithfTournament)=
  update %%ithf_tournament
  {= set
    { ,%PLAYER_ID = :player.id(call=isDef) }
    { ,%NAME = :name(call=isDef) }
    { ,%SERIES = :series(type=series,call=isDef) }
    { ,%DATE = :date(type=localdate,call=isDef) }
    { ,%POINTS = :points(call=isDef) }
    { ,%RANK = :rank(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_ITHF_TOURNAMENT(CRUD,in=IthfTournament,out=IthfTournament,tab=ithfTournament)=
  delete from %%ithf_tournament
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_ITHF_TOURNAMENT(QRY,in=IthfTournament,out=IthfTournament,tab=ithfTournament=i,tab=player=p,tab=user=u)=
  select {? :onlyIds_ | %i.ID @id(id) |
    %i.ID @id(id), %i.PLAYER_ID @player.id(id), %i.NAME @name, %i.SERIES @series(type=series), %i.DATE @date(type=localdate), %i.POINTS @points, %i.RANK @rank
    {? :player(call=toInit) | , %u.PLAYER_ID @player(gtype=user)id(id), %u.EMAIL @player.email, %u.LOGIN @player.login, %u.PASSWORD @player.password, %u.PHONE @player.phone, %u.ROLE @player.role, %u.VALIDITY @player.validity, %p.NAME @player.name, %p.SURNAME @player.surname(type=surname), %p.NICKNAME @player.nickname, %p.GENDER @player.gender, %p.DATE_OF_BIRTH @player.dateOfBirth(type=localdate), %p.COUNTRY @player.country, %p.CITY @player.city, %p.CLUB @player.club, %p.WORLD_RANKING @player.worldRanking, %p.ITHF_ID @player.ithfId, %p.NAME_ASCII @player.nameAscii, %p.SURNAME_ASCII @player.surnameAscii, %p.VERIFICATION @player.verification }
  }
  from %%ithf_tournament i
  {? :player(call=toInit) | left join %%player p on %i.PLAYER_ID = %p.ID left join %%user u on %p.ID = %u.PLAYER_ID }
  {= where
    {& %i.ID ::= :id }
    {& %i.PLAYER_ID ::= :player.id }
    {& UPPER(%i.NAME) like :+name }
    {& %i.SERIES ::= :series(type=series) }
    {& %i.DATE ::= :date(type=localdate) }
    {& %i.POINTS ::= :points }
    {& %i.RANK ::= :rank }
    {& %i.ID in :ids_ }
  }
  {#ID order by %i.ID }
  {#PLAYER order by %i.PLAYER_ID }
;

INSERT_MATCHS(CRUD,in=Matchs,out=Matchs,tab=matchs)=
  insert into %%matchs (%ID, %HOME_PLAYER_ID, %AWAY_PLAYER_ID, %GAME_ID, %GROUP_ID, %ROUND, %HOCKEY)
  {= values (:id(seq=MATCHS), :homePlayer.id, :awayPlayer.id, :game.id, :group.id, :round, :hockey) }
;

GET_MATCHS(CRUD,in=Matchs,out=Matchs,tab=matchs=m,tab=player=p1,tab=user=u1,tab=game=g,tab=groups=g1,tab=player=p,tab=user=u)=
  select %m.ID @id(id), %m.HOME_PLAYER_ID @homePlayer.id(id), %m.AWAY_PLAYER_ID @awayPlayer.id(id), %m.GAME_ID @game.id(id), %m.GROUP_ID @group.id(id), %m.ROUND @round, %m.HOCKEY @hockey
         {? :awayPlayer(call=toInit) | , %u1.PLAYER_ID @awayPlayer(gtype=user)id(id), %u1.EMAIL @awayPlayer.email, %u1.LOGIN @awayPlayer.login, %u1.PASSWORD @awayPlayer.password, %u1.PHONE @awayPlayer.phone, %u1.ROLE @awayPlayer.role, %u1.VALIDITY @awayPlayer.validity, %p1.NAME @awayPlayer.name, %p1.SURNAME @awayPlayer.surname(type=surname), %p1.NICKNAME @awayPlayer.nickname, %p1.GENDER @awayPlayer.gender, %p1.DATE_OF_BIRTH @awayPlayer.dateOfBirth(type=localdate), %p1.COUNTRY @awayPlayer.country, %p1.CITY @awayPlayer.city, %p1.CLUB @awayPlayer.club, %p1.WORLD_RANKING @awayPlayer.worldRanking, %p1.ITHF_ID @awayPlayer.ithfId, %p1.NAME_ASCII @awayPlayer.nameAscii, %p1.SURNAME_ASCII @awayPlayer.surnameAscii, %p1.VERIFICATION @awayPlayer.verification }
         {? :game(call=toInit) | , %g.HOME_GROUP_PARTICIPANT_ID @game.homeGroupParticipant.id, %g.AWAY_GROUP_PARTICIPANT_ID @game.awayGroupParticipant.id, %g.RESULT @game.result(type=result), %g.STATUS @game.status }
         {? :group(call=toInit) | , %g1.NAME @group.name, %g1.STAGE_ID @group.stage.id }
         {? :homePlayer(call=toInit) | , %u.PLAYER_ID @homePlayer(gtype=user)id(id), %u.EMAIL @homePlayer.email, %u.LOGIN @homePlayer.login, %u.PASSWORD @homePlayer.password, %u.PHONE @homePlayer.phone, %u.ROLE @homePlayer.role, %u.VALIDITY @homePlayer.validity, %p.NAME @homePlayer.name, %p.SURNAME @homePlayer.surname(type=surname), %p.NICKNAME @homePlayer.nickname, %p.GENDER @homePlayer.gender, %p.DATE_OF_BIRTH @homePlayer.dateOfBirth(type=localdate), %p.COUNTRY @homePlayer.country, %p.CITY @homePlayer.city, %p.CLUB @homePlayer.club, %p.WORLD_RANKING @homePlayer.worldRanking, %p.ITHF_ID @homePlayer.ithfId, %p.NAME_ASCII @homePlayer.nameAscii, %p.SURNAME_ASCII @homePlayer.surnameAscii, %p.VERIFICATION @homePlayer.verification }
  from %%matchs m
  {? :awayPlayer(call=toInit) | left join %%player p1 on %m.AWAY_PLAYER_ID = %p1.ID left join %%user u1 on %p1.ID = %u1.PLAYER_ID }
  {? :game(call=toInit) | left join %%game g on %m.GAME_ID = %g.ID }
  {? :group(call=toInit) | left join %%groups g1 on %m.GROUP_ID = %g1.ID }
  {? :homePlayer(call=toInit) | left join %%player p on %m.HOME_PLAYER_ID = %p.ID left join %%user u on %p.ID = %u.PLAYER_ID }
  {= where
    {& %m.ID ::= :id }
    {& %m.HOME_PLAYER_ID ::= :homePlayer.id }
    {& %m.AWAY_PLAYER_ID ::= :awayPlayer.id }
    {& %m.GAME_ID ::= :game.id }
    {& %m.GROUP_ID ::= :group.id }
    {& %m.ROUND ::= :round }
    {& %m.HOCKEY ::= :hockey }
  }
;

UPDATE_MATCHS(CRUD,in=Matchs,out=Matchs,tab=matchs)=
  update %%matchs
  {= set
    { ,%HOME_PLAYER_ID = :homePlayer.id(call=isDef) }
    { ,%AWAY_PLAYER_ID = :awayPlayer.id(call=isDef) }
    { ,%GAME_ID = :game.id(call=isDef) }
    { ,%GROUP_ID = :group.id(call=isDef) }
    { ,%ROUND = :round(call=isDef) }
    { ,%HOCKEY = :hockey(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_MATCHS(CRUD,in=Matchs,out=Matchs,tab=matchs)=
  delete from %%matchs
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_MATCHS(QRY,in=Matchs,out=Matchs,tab=matchs=m,tab=player=p1,tab=user=u1,tab=game=g,tab=groups=g1,tab=player=p,tab=user=u)=
  select {? :onlyIds_ | %m.ID @id(id) |
    %m.ID @id(id), %m.HOME_PLAYER_ID @homePlayer.id(id), %m.AWAY_PLAYER_ID @awayPlayer.id(id), %m.GAME_ID @game.id(id), %m.GROUP_ID @group.id(id), %m.ROUND @round, %m.HOCKEY @hockey
    {? :awayPlayer(call=toInit) | , %u1.PLAYER_ID @awayPlayer(gtype=user)id(id), %u1.EMAIL @awayPlayer.email, %u1.LOGIN @awayPlayer.login, %u1.PASSWORD @awayPlayer.password, %u1.PHONE @awayPlayer.phone, %u1.ROLE @awayPlayer.role, %u1.VALIDITY @awayPlayer.validity, %p1.NAME @awayPlayer.name, %p1.SURNAME @awayPlayer.surname(type=surname), %p1.NICKNAME @awayPlayer.nickname, %p1.GENDER @awayPlayer.gender, %p1.DATE_OF_BIRTH @awayPlayer.dateOfBirth(type=localdate), %p1.COUNTRY @awayPlayer.country, %p1.CITY @awayPlayer.city, %p1.CLUB @awayPlayer.club, %p1.WORLD_RANKING @awayPlayer.worldRanking, %p1.ITHF_ID @awayPlayer.ithfId, %p1.NAME_ASCII @awayPlayer.nameAscii, %p1.SURNAME_ASCII @awayPlayer.surnameAscii, %p1.VERIFICATION @awayPlayer.verification }
    {? :game(call=toInit) | , %g.HOME_GROUP_PARTICIPANT_ID @game.homeGroupParticipant.id, %g.AWAY_GROUP_PARTICIPANT_ID @game.awayGroupParticipant.id, %g.RESULT @game.result(type=result), %g.STATUS @game.status }
    {? :group(call=toInit) | , %g1.NAME @group.name, %g1.STAGE_ID @group.stage.id }
    {? :homePlayer(call=toInit) | , %u.PLAYER_ID @homePlayer(gtype=user)id(id), %u.EMAIL @homePlayer.email, %u.LOGIN @homePlayer.login, %u.PASSWORD @homePlayer.password, %u.PHONE @homePlayer.phone, %u.ROLE @homePlayer.role, %u.VALIDITY @homePlayer.validity, %p.NAME @homePlayer.name, %p.SURNAME @homePlayer.surname(type=surname), %p.NICKNAME @homePlayer.nickname, %p.GENDER @homePlayer.gender, %p.DATE_OF_BIRTH @homePlayer.dateOfBirth(type=localdate), %p.COUNTRY @homePlayer.country, %p.CITY @homePlayer.city, %p.CLUB @homePlayer.club, %p.WORLD_RANKING @homePlayer.worldRanking, %p.ITHF_ID @homePlayer.ithfId, %p.NAME_ASCII @homePlayer.nameAscii, %p.SURNAME_ASCII @homePlayer.surnameAscii, %p.VERIFICATION @homePlayer.verification }
  }
  from %%matchs m
  {? :awayPlayer(call=toInit) | left join %%player p1 on %m.AWAY_PLAYER_ID = %p1.ID left join %%user u1 on %p1.ID = %u1.PLAYER_ID }
  {? :game(call=toInit) | left join %%game g on %m.GAME_ID = %g.ID }
  {? :group(call=toInit) | left join %%groups g1 on %m.GROUP_ID = %g1.ID }
  {? :homePlayer(call=toInit) | left join %%player p on %m.HOME_PLAYER_ID = %p.ID left join %%user u on %p.ID = %u.PLAYER_ID }
  {= where
    {& %m.ID ::= :id }
    {& %m.HOME_PLAYER_ID ::= :homePlayer.id }
    {& %m.AWAY_PLAYER_ID ::= :awayPlayer.id }
    {& %m.GAME_ID ::= :game.id }
    {& %m.GROUP_ID ::= :group.id }
    {& %m.ROUND ::= :round }
    {& %m.HOCKEY ::= :hockey }
    {& %m.ID in :ids_ }
  }
  {#ID order by %m.ID }
  {#HOME_PLAYER order by %m.HOME_PLAYER_ID }
  {#AWAY_PLAYER order by %m.AWAY_PLAYER_ID }
  {#GAME order by %m.GAME_ID }
  {#GROUP order by %m.GROUP_ID }
  {#ROUND order by %m.ROUND }
  {#HOCKEY order by %m.HOCKEY }
;

INSERT_PARTICIPANT(CRUD,in=Participant,out=Participant,tab=participant)=
  insert into %%participant (%ID, %TOURNAMENT_ID, %PLAYER_ID)
  {= values (:id(seq=PARTICIPANT), :tournament.id, :player.id) }
;

GET_PARTICIPANT(CRUD,in=Participant,out=Participant,tab=participant=p,tab=finalStanding=f,tab=groupParticipant=g,tab=player=p1,tab=user=u,tab=playOffGame=p2,tab=tournament=t)=
  select %p.ID @id(id), %p.TOURNAMENT_ID @tournament.id(id), %p.PLAYER_ID @player.id(id)
         {? :finalStandings(call=toInit) | , %f.ID @finalStandings.id(id), %f.PARTICIPANT_ID @finalStandings.participant.id, %f.FINAL_RANK @finalStandings.finalRank }
         {? :groupParticipants(call=toInit) | , %g.ID @groupParticipants.id(id), %g.GROUP_ID @groupParticipants.group.id, %g.PARTICIPANT_ID @groupParticipants.participant.id, %g.POINTS @groupParticipants.points, %g.SCORE @groupParticipants.score(type=score), %g.RANK @groupParticipants.rank, %g.SECONDARY_RANK @groupParticipants.secondaryRank }
         {? :player(call=toInit) | , %u.PLAYER_ID @player(gtype=user)id(id), %u.EMAIL @player.email, %u.LOGIN @player.login, %u.PASSWORD @player.password, %u.PHONE @player.phone, %u.ROLE @player.role, %u.VALIDITY @player.validity, %p1.NAME @player.name, %p1.SURNAME @player.surname(type=surname), %p1.NICKNAME @player.nickname, %p1.GENDER @player.gender, %p1.DATE_OF_BIRTH @player.dateOfBirth(type=localdate), %p1.COUNTRY @player.country, %p1.CITY @player.city, %p1.CLUB @player.club, %p1.WORLD_RANKING @player.worldRanking, %p1.ITHF_ID @player.ithfId, %p1.NAME_ASCII @player.nameAscii, %p1.SURNAME_ASCII @player.surnameAscii, %p1.VERIFICATION @player.verification }
         {? :playOffGames(call=toInit) | , %p2.ID @playOffGames.id(id), %p2.HOME_PARTICIPANT_ID @playOffGames.homeParticipant.id, %p2.AWAY_PARTICIPANT_ID @playOffGames.awayParticipant.id, %p2.STATUS @playOffGames.status, %p2.RESULT @playOffGames.result(type=result), %p2.STAGE_ID @playOffGames.stage.id, %p2.POSITION @playOffGames.position }
         {? :tournament(call=toInit) | , %t.NAME @tournament.name, %t.STATUS @tournament.status, %t.PLAYING_FORMAT_ID @tournament.playingFormat.id, %t.COUNTRY @tournament.country, %t.CITY @tournament.city, %t.ADDRESS @tournament.address, %t.LOGO @tournament.logo, %t.REGISTRATION_FROM @tournament.registrationFrom(type=localdatetime), %t.TOURNAMENT_DATE @tournament.tournamentDate(type=localdate), %t.REGISTRATION_TO @tournament.registrationTo(type=localdatetime), %t.VISIBLE @tournament.visible }
  from %%participant p
  {? :finalStandings(call=toInit) | left join %%final_standing f on %p.ID = %f.PARTICIPANT_ID }
  {? :groupParticipants(call=toInit) | left join %%group_participant g on %p.ID = %g.PARTICIPANT_ID }
  {? :player(call=toInit) | left join %%player p1 on %p.PLAYER_ID = %p1.ID left join %%user u on %p1.ID = %u.PLAYER_ID }
  {? :playOffGames(call=toInit) | left join %%play_off_game p2 on %p.ID = %p2.AWAY_PARTICIPANT_ID }
  {? :tournament(call=toInit) | left join %%tournament t on %p.TOURNAMENT_ID = %t.ID }
  {= where
    {& %p.ID ::= :id }
    {& %p.TOURNAMENT_ID ::= :tournament.id }
    {& %p.PLAYER_ID ::= :player.id }
  }
;

UPDATE_PARTICIPANT(CRUD,in=Participant,out=Participant,tab=participant)=
  update %%participant
  {= set
    { ,%TOURNAMENT_ID = :tournament.id }
    { ,%PLAYER_ID = :player.id }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_PARTICIPANT(CRUD,in=Participant,out=Participant,tab=participant)=
  delete from %%participant
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_PARTICIPANT(QRY,in=Participant,out=Participant,tab=participant=p,tab=finalStanding=f,tab=groupParticipant=g,tab=player=p1,tab=user=u,tab=playOffGame=p2,tab=tournament=t)=
  select {? :onlyIds_ | %p.ID @id(id) |
    %p.ID @id(id), %p.TOURNAMENT_ID @tournament.id(id), %p.PLAYER_ID @player.id(id)
    {? :finalStandings(call=toInit) | , %f.ID @finalStandings.id(id), %f.PARTICIPANT_ID @finalStandings.participant.id, %f.FINAL_RANK @finalStandings.finalRank }
    {? :groupParticipants(call=toInit) | , %g.ID @groupParticipants.id(id), %g.GROUP_ID @groupParticipants.group.id, %g.PARTICIPANT_ID @groupParticipants.participant.id, %g.POINTS @groupParticipants.points, %g.SCORE @groupParticipants.score(type=score), %g.RANK @groupParticipants.rank, %g.SECONDARY_RANK @groupParticipants.secondaryRank }
    {? :player(call=toInit) | , %u.PLAYER_ID @player(gtype=user)id(id), %u.EMAIL @player.email, %u.LOGIN @player.login, %u.PASSWORD @player.password, %u.PHONE @player.phone, %u.ROLE @player.role, %u.VALIDITY @player.validity, %p1.NAME @player.name, %p1.SURNAME @player.surname(type=surname), %p1.NICKNAME @player.nickname, %p1.GENDER @player.gender, %p1.DATE_OF_BIRTH @player.dateOfBirth(type=localdate), %p1.COUNTRY @player.country, %p1.CITY @player.city, %p1.CLUB @player.club, %p1.WORLD_RANKING @player.worldRanking, %p1.ITHF_ID @player.ithfId, %p1.NAME_ASCII @player.nameAscii, %p1.SURNAME_ASCII @player.surnameAscii, %p1.VERIFICATION @player.verification }
    {? :playOffGames(call=toInit) | , %p2.ID @playOffGames.id(id), %p2.HOME_PARTICIPANT_ID @playOffGames.homeParticipant.id, %p2.AWAY_PARTICIPANT_ID @playOffGames.awayParticipant.id, %p2.STATUS @playOffGames.status, %p2.RESULT @playOffGames.result(type=result), %p2.STAGE_ID @playOffGames.stage.id, %p2.POSITION @playOffGames.position }
    {? :tournament(call=toInit) | , %t.NAME @tournament.name, %t.STATUS @tournament.status, %t.PLAYING_FORMAT_ID @tournament.playingFormat.id, %t.COUNTRY @tournament.country, %t.CITY @tournament.city, %t.ADDRESS @tournament.address, %t.LOGO @tournament.logo, %t.REGISTRATION_FROM @tournament.registrationFrom(type=localdatetime), %t.TOURNAMENT_DATE @tournament.tournamentDate(type=localdate), %t.REGISTRATION_TO @tournament.registrationTo(type=localdatetime), %t.VISIBLE @tournament.visible }
  }
  from %%participant p
  {? :finalStandings(call=toInit) | left join %%final_standing f on %p.ID = %f.PARTICIPANT_ID }
  {? :groupParticipants(call=toInit) | left join %%group_participant g on %p.ID = %g.PARTICIPANT_ID }
  {? :player(call=toInit) | left join %%player p1 on %p.PLAYER_ID = %p1.ID left join %%user u on %p1.ID = %u.PLAYER_ID }
  {? :playOffGames(call=toInit) | left join %%play_off_game p2 on %p.ID = %p2.AWAY_PARTICIPANT_ID }
  {? :tournament(call=toInit) | left join %%tournament t on %p.TOURNAMENT_ID = %t.ID }
  {= where
    {& %p.ID ::= :id }
    {& %p.TOURNAMENT_ID ::= :tournament.id }
    {& %p.PLAYER_ID ::= :player.id }
    {& %p.ID in :ids_ }
  }
  {#ID order by %p.ID }
  {#TOURNAMENT order by %p.TOURNAMENT_ID }
  {#PLAYER order by %p.PLAYER_ID }
;

INSERT_PLAY_OFF_GAME(CRUD,in=PlayOffGame,out=PlayOffGame,tab=playOffGame)=
  insert into %%play_off_game (%ID, %HOME_PARTICIPANT_ID, %AWAY_PARTICIPANT_ID, %STATUS, %RESULT, %STAGE_ID, %POSITION)
  {= values (:id(seq=PLAY_OFF_GAME), :homeParticipant.id, :awayParticipant.id, :status, :result(type=result), :stage.id, :position) }
;

GET_PLAY_OFF_GAME(CRUD,in=PlayOffGame,out=PlayOffGame,tab=playOffGame=p,tab=participant=p2,tab=participant=p1,tab=stage=s)=
  select %p.ID @id(id), %p.HOME_PARTICIPANT_ID @homeParticipant.id(id), %p.AWAY_PARTICIPANT_ID @awayParticipant.id(id), %p.STATUS @status, %p.RESULT @result(type=result), %p.STAGE_ID @stage.id(id), %p.POSITION @position
         {? :awayParticipant(call=toInit) | , %p2.TOURNAMENT_ID @awayParticipant.tournament.id, %p2.PLAYER_ID @awayParticipant.player.id }
         {? :homeParticipant(call=toInit) | , %p1.TOURNAMENT_ID @homeParticipant.tournament.id, %p1.PLAYER_ID @homeParticipant.player.id }
         {? :stage(call=toInit) | , %s.NAME @stage.name, %s.SEQUENCE @stage.sequence, %s.NUMBER_OF_HOCKEY @stage.numberOfHockey, %s.WIN_POINTS @stage.winPoints, %s.TYPE @stage.type, %s.TOURNAMENT_ID @stage.tournament.id, %s.STATUS @stage.status, %s.COPY_RESULT_STAGE_ID @stage.copyResultStage.id }
  from %%play_off_game p
  {? :awayParticipant(call=toInit) | left join %%participant p2 on %p.AWAY_PARTICIPANT_ID = %p2.ID }
  {? :homeParticipant(call=toInit) | left join %%participant p1 on %p.HOME_PARTICIPANT_ID = %p1.ID }
  {? :stage(call=toInit) | left join %%stage s on %p.STAGE_ID = %s.ID }
  {= where
    {& %p.ID ::= :id }
    {& %p.HOME_PARTICIPANT_ID ::= :homeParticipant.id }
    {& %p.AWAY_PARTICIPANT_ID ::= :awayParticipant.id }
    {& %p.STATUS ::= :status }
    {& %p.RESULT ::= :result(type=result) }
    {& %p.STAGE_ID ::= :stage.id }
    {& %p.POSITION ::= :position }
  }
;

UPDATE_PLAY_OFF_GAME(CRUD,in=PlayOffGame,out=PlayOffGame,tab=playOffGame)=
  update %%play_off_game
  {= set
    { ,%HOME_PARTICIPANT_ID = :homeParticipant.id(call=isDef) }
    { ,%AWAY_PARTICIPANT_ID = :awayParticipant.id(call=isDef) }
    { ,%STATUS = :status(call=isDef) }
    { ,%RESULT = :result(type=result,call=isDef) }
    { ,%STAGE_ID = :stage.id(call=isDef) }
    { ,%POSITION = :position(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_PLAY_OFF_GAME(CRUD,in=PlayOffGame,out=PlayOffGame,tab=playOffGame)=
  delete from %%play_off_game
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_PLAY_OFF_GAME(QRY,in=PlayOffGame,out=PlayOffGame,tab=playOffGame=p,tab=participant=p2,tab=participant=p1,tab=stage=s)=
  select {? :onlyIds_ | %p.ID @id(id) |
    %p.ID @id(id), %p.HOME_PARTICIPANT_ID @homeParticipant.id(id), %p.AWAY_PARTICIPANT_ID @awayParticipant.id(id), %p.STATUS @status, %p.RESULT @result(type=result), %p.STAGE_ID @stage.id(id), %p.POSITION @position
    {? :awayParticipant(call=toInit) | , %p2.TOURNAMENT_ID @awayParticipant.tournament.id, %p2.PLAYER_ID @awayParticipant.player.id }
    {? :homeParticipant(call=toInit) | , %p1.TOURNAMENT_ID @homeParticipant.tournament.id, %p1.PLAYER_ID @homeParticipant.player.id }
    {? :stage(call=toInit) | , %s.NAME @stage.name, %s.SEQUENCE @stage.sequence, %s.NUMBER_OF_HOCKEY @stage.numberOfHockey, %s.WIN_POINTS @stage.winPoints, %s.TYPE @stage.type, %s.TOURNAMENT_ID @stage.tournament.id, %s.STATUS @stage.status, %s.COPY_RESULT_STAGE_ID @stage.copyResultStage.id }
  }
  from %%play_off_game p
  {? :awayParticipant(call=toInit) | left join %%participant p2 on %p.AWAY_PARTICIPANT_ID = %p2.ID }
  {? :homeParticipant(call=toInit) | left join %%participant p1 on %p.HOME_PARTICIPANT_ID = %p1.ID }
  {? :stage(call=toInit) | left join %%stage s on %p.STAGE_ID = %s.ID }
  {= where
    {& %p.ID ::= :id }
    {& %p.HOME_PARTICIPANT_ID ::= :homeParticipant.id }
    {& %p.AWAY_PARTICIPANT_ID ::= :awayParticipant.id }
    {& UPPER(%p.STATUS) like :+status }
    {& %p.RESULT ::= :result(type=result) }
    {& %p.STAGE_ID ::= :stage.id }
    {& %p.POSITION ::= :position }
    {& %p.ID in :ids_ }
  }
  {#ID order by %p.ID }
  {#HOME_PARTICIPANT order by %p.HOME_PARTICIPANT_ID }
  {#AWAY_PARTICIPANT order by %p.AWAY_PARTICIPANT_ID }
  {#STAGE order by %p.STAGE_ID }
  {#POSITION order by %p.POSITION }
;

INSERT_PLAYER(CRUD,in=Player,out=Player,tab=player)=
  insert into %%player (%ID, %NAME, %SURNAME, %NICKNAME, %GENDER, %DATE_OF_BIRTH, %COUNTRY, %CITY, %CLUB, %WORLD_RANKING, %ITHF_ID, %NAME_ASCII, %SURNAME_ASCII, %VERIFICATION)
  {= values (:id(seq=PLAYER), :name, :surname(type=surname), :nickname, :gender, :dateOfBirth(type=localdate), :country, :city, :club, :worldRanking, :ithfId, :nameAscii, :surnameAscii, :verification) }
;

GET_PLAYER(CRUD,in=Player,out=Player,tab=player=p,tab=ithfTournament=i,tab=matchs=m,tab=participant=p1)=
  select %p.ID @id(id), %p.NAME @name, %p.SURNAME @surname(type=surname), %p.NICKNAME @nickname, %p.GENDER @gender, %p.DATE_OF_BIRTH @dateOfBirth(type=localdate), %p.COUNTRY @country, %p.CITY @city, %p.CLUB @club, %p.WORLD_RANKING @worldRanking, %p.ITHF_ID @ithfId, %p.NAME_ASCII @nameAscii, %p.SURNAME_ASCII @surnameAscii, %p.VERIFICATION @verification
         {? :ithfTournaments(call=toInit) | , %i.ID @ithfTournaments.id(id), %i.PLAYER_ID @ithfTournaments.player.id, %i.NAME @ithfTournaments.name, %i.SERIES @ithfTournaments.series(type=series), %i.DATE @ithfTournaments.date(type=localdate), %i.POINTS @ithfTournaments.points, %i.RANK @ithfTournaments.rank }
         {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
         {? :participants(call=toInit) | , %p1.ID @participants.id(id), %p1.TOURNAMENT_ID @participants.tournament.id, %p1.PLAYER_ID @participants.player.id }
  from %%player p
  {? :ithfTournaments(call=toInit) | left join %%ithf_tournament i on %p.ID = %i.PLAYER_ID }
  {? :matchs(call=toInit) | left join %%matchs m on %p.ID = %m.AWAY_PLAYER_ID }
  {? :participants(call=toInit) | left join %%participant p1 on %p.ID = %p1.PLAYER_ID }
  {= where
    {& %p.ID ::= :id }
    {& %p.NAME ::= :name }
    {& %p.SURNAME ::= :surname(type=surname) }
    {& %p.NICKNAME ::= :nickname }
    {& %p.GENDER ::= :gender }
    {& %p.DATE_OF_BIRTH ::= :dateOfBirth(type=localdate) }
    {& %p.COUNTRY ::= :country }
    {& %p.CITY ::= :city }
    {& %p.CLUB ::= :club }
    {& %p.WORLD_RANKING ::= :worldRanking }
    {& %p.ITHF_ID ::= :ithfId }
    {& %p.NAME_ASCII ::= :nameAscii }
    {& %p.SURNAME_ASCII ::= :surnameAscii }
    {& %p.VERIFICATION ::= :verification }
  }
;

UPDATE_PLAYER(CRUD,in=Player,out=Player,tab=player)=
  update %%player
  {= set
    { ,%NAME = :name(call=isDef) }
    { ,%SURNAME = :surname(type=surname,call=isDef) }
    { ,%NICKNAME = :nickname(call=isDef) }
    { ,%GENDER = :gender(call=isDef) }
    { ,%DATE_OF_BIRTH = :dateOfBirth(type=localdate,call=isDef) }
    { ,%COUNTRY = :country(call=isDef) }
    { ,%CITY = :city(call=isDef) }
    { ,%CLUB = :club(call=isDef) }
    { ,%WORLD_RANKING = :worldRanking(call=isDef) }
    { ,%ITHF_ID = :ithfId(call=isDef) }
    { ,%NAME_ASCII = :nameAscii(call=isDef) }
    { ,%SURNAME_ASCII = :surnameAscii(call=isDef) }
    { ,%VERIFICATION = :verification(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_PLAYER(CRUD,in=Player,out=Player,tab=player)=
  delete from %%player
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_PLAYER(QRY,in=Player,out=Player,tab=player=p,tab=ithfTournament=i,tab=matchs=m,tab=participant=p1)=
  select {? :onlyIds_ | %p.ID @id(id) |
    %p.ID @id(id), %p.NAME @name, %p.SURNAME @surname(type=surname), %p.NICKNAME @nickname, %p.GENDER @gender, %p.DATE_OF_BIRTH @dateOfBirth(type=localdate), %p.COUNTRY @country, %p.CITY @city, %p.CLUB @club, %p.WORLD_RANKING @worldRanking, %p.ITHF_ID @ithfId, %p.NAME_ASCII @nameAscii, %p.SURNAME_ASCII @surnameAscii, %p.VERIFICATION @verification
    {? :ithfTournaments(call=toInit) | , %i.ID @ithfTournaments.id(id), %i.PLAYER_ID @ithfTournaments.player.id, %i.NAME @ithfTournaments.name, %i.SERIES @ithfTournaments.series(type=series), %i.DATE @ithfTournaments.date(type=localdate), %i.POINTS @ithfTournaments.points, %i.RANK @ithfTournaments.rank }
    {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
    {? :participants(call=toInit) | , %p1.ID @participants.id(id), %p1.TOURNAMENT_ID @participants.tournament.id, %p1.PLAYER_ID @participants.player.id }
  }
  from %%player p
  {? :ithfTournaments(call=toInit) | left join %%ithf_tournament i on %p.ID = %i.PLAYER_ID }
  {? :matchs(call=toInit) | left join %%matchs m on %p.ID = %m.AWAY_PLAYER_ID }
  {? :participants(call=toInit) | left join %%participant p1 on %p.ID = %p1.PLAYER_ID }
  {= where
    {& %p.ID ::= :id }
    {& UPPER(%p.NAME) like :+name }
    {& %p.SURNAME ::= :surname(type=surname) }
    {& UPPER(%p.NICKNAME) like :+nickname }
    {& UPPER(%p.GENDER) like :+gender }
    {& %p.DATE_OF_BIRTH ::= :dateOfBirth(type=localdate) }
    {& UPPER(%p.COUNTRY) like :+country }
    {& UPPER(%p.CITY) like :+city }
    {& UPPER(%p.CLUB) like :+club }
    {& %p.WORLD_RANKING ::= :worldRanking }
    {& %p.ITHF_ID ::= :ithfId }
    {& UPPER(%p.NAME_ASCII) like :+nameAscii }
    {& UPPER(%p.SURNAME_ASCII) like :+surnameAscii }
    {& %p.VERIFICATION ::= :verification }
    {& %p.ID in :ids_ }
  }
  {#ID order by %p.ID }
;

INSERT_PLAYING_FORMAT(CRUD,in=PlayingFormat,out=PlayingFormat,tab=playingFormat)=
  insert into %%playing_format (%ID, %NAME, %FINAL_PROMOTING, %LOWER_PROMOTING, %WIN_POINTS, %PLAY_OFF_FINAL, %PLAY_OFF_LOWER, %MIN_PLAYERS_IN_GROUP, %SORT_TYPE, %DESCRIPTION)
  {= values (:id(seq=PLAYING_FORMAT), :name, :finalPromoting, :lowerPromoting, :winPoints, :playOffFinal, :playOffLower, :minPlayersInGroup, :sortType, :description) }
;

GET_PLAYING_FORMAT(CRUD,in=PlayingFormat,out=PlayingFormat,tab=playingFormat)=
  select %ID @id(id), %NAME @name, %FINAL_PROMOTING @finalPromoting, %LOWER_PROMOTING @lowerPromoting, %WIN_POINTS @winPoints, %PLAY_OFF_FINAL @playOffFinal, %PLAY_OFF_LOWER @playOffLower, %MIN_PLAYERS_IN_GROUP @minPlayersInGroup, %SORT_TYPE @sortType, %DESCRIPTION @description
  from %%playing_format
  {= where
    {& %ID ::= :id }
    {& %NAME ::= :name }
    {& %FINAL_PROMOTING ::= :finalPromoting }
    {& %LOWER_PROMOTING ::= :lowerPromoting }
    {& %WIN_POINTS ::= :winPoints }
    {& %PLAY_OFF_FINAL ::= :playOffFinal }
    {& %PLAY_OFF_LOWER ::= :playOffLower }
    {& %MIN_PLAYERS_IN_GROUP ::= :minPlayersInGroup }
    {& %SORT_TYPE ::= :sortType }
    {& %DESCRIPTION ::= :description }
  }
;

UPDATE_PLAYING_FORMAT(CRUD,in=PlayingFormat,out=PlayingFormat,tab=playingFormat)=
  update %%playing_format
  {= set
    { ,%NAME = :name }
    { ,%FINAL_PROMOTING = :finalPromoting }
    { ,%LOWER_PROMOTING = :lowerPromoting }
    { ,%WIN_POINTS = :winPoints }
    { ,%PLAY_OFF_FINAL = :playOffFinal }
    { ,%PLAY_OFF_LOWER = :playOffLower }
    { ,%MIN_PLAYERS_IN_GROUP = :minPlayersInGroup }
    { ,%SORT_TYPE = :sortType }
    { ,%DESCRIPTION = :description }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_PLAYING_FORMAT(CRUD,in=PlayingFormat,out=PlayingFormat,tab=playingFormat)=
  delete from %%playing_format
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_PLAYING_FORMAT(QRY,in=PlayingFormat,out=PlayingFormat,tab=playingFormat)=
  select {? :onlyIds_ | %ID @id(id) |
    %ID @id(id), %NAME @name, %FINAL_PROMOTING @finalPromoting, %LOWER_PROMOTING @lowerPromoting, %WIN_POINTS @winPoints, %PLAY_OFF_FINAL @playOffFinal, %PLAY_OFF_LOWER @playOffLower, %MIN_PLAYERS_IN_GROUP @minPlayersInGroup, %SORT_TYPE @sortType, %DESCRIPTION @description
  }
  from %%playing_format
  {= where
    {& %ID ::= :id }
    {& UPPER(%NAME) like :+name }
    {& %FINAL_PROMOTING ::= :finalPromoting }
    {& %LOWER_PROMOTING ::= :lowerPromoting }
    {& %WIN_POINTS ::= :winPoints }
    {& %PLAY_OFF_FINAL ::= :playOffFinal }
    {& %PLAY_OFF_LOWER ::= :playOffLower }
    {& %MIN_PLAYERS_IN_GROUP ::= :minPlayersInGroup }
    {& UPPER(%SORT_TYPE) like :+sortType }
    {& UPPER(%DESCRIPTION) like :+description }
    {& %ID in :ids_ }
  }
  {#ID order by %ID }
;

INSERT_RATING(CRUD,in=Rating,out=Rating,tab=rating)=
  insert into %%rating (%ID, %RATING_POINTS_ID)
  {= values (:id(seq=RATING), :ratingPoints.id) }
;

GET_RATING(CRUD,in=Rating,out=Rating,tab=rating=r,tab=ratingPoints=r1,tab=tournamentRating=t,tab=tournament=t1)=
  select %r.ID @id(id), %r.RATING_POINTS_ID @ratingPoints.id(id)
         {? :ratingPoints(call=toInit) | , %r1.NAME @ratingPoints.name, %r1.POINTS @ratingPoints.points, %r1.RANK @ratingPoints.rank }
         {? :tournament(call=toInit) | , %t1.ID @tournament.id(id), %t1.NAME @tournament.name, %t1.STATUS @tournament.status, %t1.PLAYING_FORMAT_ID @tournament.playingFormat.id, %t1.COUNTRY @tournament.country, %t1.CITY @tournament.city, %t1.ADDRESS @tournament.address, %t1.LOGO @tournament.logo, %t1.REGISTRATION_FROM @tournament.registrationFrom(type=localdatetime), %t1.TOURNAMENT_DATE @tournament.tournamentDate(type=localdate), %t1.REGISTRATION_TO @tournament.registrationTo(type=localdatetime), %t1.VISIBLE @tournament.visible }
  from %%rating r
  {? :ratingPoints(call=toInit) | left join %%rating_points r1 on %r.RATING_POINTS_ID = %r1.ID }
  {? :tournament(call=toInit) | left join %%tournament_rating t on %r.ID = %t.RATING_ID left join %%tournament t1 on %t.TOURNAMENT_ID = %t1.ID }
  {= where
    {& %r.ID ::= :id }
    {& %r.RATING_POINTS_ID ::= :ratingPoints.id }
  }
;

UPDATE_RATING(CRUD,in=Rating,out=Rating,tab=rating)=
  update %%rating
  {= set
    { ,%RATING_POINTS_ID = :ratingPoints.id(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_RATING(CRUD,in=Rating,out=Rating,tab=rating)=
  delete from %%rating
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_RATING(QRY,in=Rating,out=Rating,tab=rating=r,tab=ratingPoints=r1,tab=tournamentRating=t,tab=tournament=t1)=
  select {? :onlyIds_ | %r.ID @id(id) |
    %r.ID @id(id), %r.RATING_POINTS_ID @ratingPoints.id(id)
    {? :ratingPoints(call=toInit) | , %r1.NAME @ratingPoints.name, %r1.POINTS @ratingPoints.points, %r1.RANK @ratingPoints.rank }
    {? :tournament(call=toInit) | , %t1.ID @tournament.id(id), %t1.NAME @tournament.name, %t1.STATUS @tournament.status, %t1.PLAYING_FORMAT_ID @tournament.playingFormat.id, %t1.COUNTRY @tournament.country, %t1.CITY @tournament.city, %t1.ADDRESS @tournament.address, %t1.LOGO @tournament.logo, %t1.REGISTRATION_FROM @tournament.registrationFrom(type=localdatetime), %t1.TOURNAMENT_DATE @tournament.tournamentDate(type=localdate), %t1.REGISTRATION_TO @tournament.registrationTo(type=localdatetime), %t1.VISIBLE @tournament.visible }
  }
  from %%rating r
  {? :ratingPoints(call=toInit) | left join %%rating_points r1 on %r.RATING_POINTS_ID = %r1.ID }
  {? :tournament(call=toInit) | left join %%tournament_rating t on %r.ID = %t.RATING_ID left join %%tournament t1 on %t.TOURNAMENT_ID = %t1.ID }
  {= where
    {& %r.ID ::= :id }
    {& %r.RATING_POINTS_ID ::= :ratingPoints.id }
    {& %r.ID in :ids_ }
  }
  {#ID order by %r.ID }
  {#RATING_POINTS order by %r.RATING_POINTS_ID }
;

INSERT_RATING_POINTS(CRUD,in=RatingPoints,out=RatingPoints,tab=ratingPoints)=
  insert into %%rating_points (%ID, %NAME, %POINTS, %RANK)
  {= values (:id, :name, :points, :rank) }
;

GET_RATING_POINTS(CRUD,in=RatingPoints,out=RatingPoints,tab=ratingPoints=r,tab=rating=r1)=
  select %r.ID @id(id), %r.NAME @name, %r.POINTS @points, %r.RANK @rank
         {? :ratings(call=toInit) | , %r1.ID @ratings.id(id), %r1.RATING_POINTS_ID @ratings.ratingPoints.id }
  from %%rating_points r
  {? :ratings(call=toInit) | left join %%rating r1 on %r.ID = %r1.RATING_POINTS_ID }
  {= where
    {& %r.ID ::= :id }
    {& %r.NAME ::= :name }
    {& %r.POINTS ::= :points }
    {& %r.RANK ::= :rank }
  }
;

UPDATE_RATING_POINTS(CRUD,in=RatingPoints,out=RatingPoints,tab=ratingPoints)=
  update %%rating_points
  {= set
    { ,%NAME = :name }
    { ,%POINTS = :points }
    { ,%RANK = :rank }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_RATING_POINTS(CRUD,in=RatingPoints,out=RatingPoints,tab=ratingPoints)=
  delete from %%rating_points
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_RATING_POINTS(QRY,in=RatingPoints,out=RatingPoints,tab=ratingPoints=r,tab=rating=r1)=
  select {? :onlyIds_ | %r.ID @id(id) |
    %r.ID @id(id), %r.NAME @name, %r.POINTS @points, %r.RANK @rank
    {? :ratings(call=toInit) | , %r1.ID @ratings.id(id), %r1.RATING_POINTS_ID @ratings.ratingPoints.id }
  }
  from %%rating_points r
  {? :ratings(call=toInit) | left join %%rating r1 on %r.ID = %r1.RATING_POINTS_ID }
  {= where
    {& %r.ID ::= :id }
    {& UPPER(%r.NAME) like :+name }
    {& %r.POINTS ::= :points }
    {& %r.RANK ::= :rank }
    {& %r.ID in :ids_ }
  }
  {#ID order by %r.ID }
;

INSERT_STAGE(CRUD,in=Stage,out=Stage,tab=stage)=
  insert into %%stage (%ID, %NAME, %SEQUENCE, %NUMBER_OF_HOCKEY, %WIN_POINTS, %TYPE, %TOURNAMENT_ID, %STATUS, %COPY_RESULT_STAGE_ID)
  {= values (:id(seq=STAGE), :name, :sequence, :numberOfHockey, :winPoints, :type, :tournament.id, :status, :copyResultStage.id) }
;

GET_STAGE(CRUD,in=Stage,out=Stage,tab=stage=s,tab=stage=s1,tab=groups=g,tab=playOffGame=p,tab=tournament=t)=
  select %s.ID @id(id), %s.NAME @name, %s.SEQUENCE @sequence, %s.NUMBER_OF_HOCKEY @numberOfHockey, %s.WIN_POINTS @winPoints, %s.TYPE @type, %s.TOURNAMENT_ID @tournament.id(id), %s.STATUS @status, %s.COPY_RESULT_STAGE_ID @copyResultStage.id(id)
         {? :copyResultStage(call=toInit) | , %s1.NAME @copyResultStage.name, %s1.SEQUENCE @copyResultStage.sequence, %s1.NUMBER_OF_HOCKEY @copyResultStage.numberOfHockey, %s1.WIN_POINTS @copyResultStage.winPoints, %s1.TYPE @copyResultStage.type, %s1.TOURNAMENT_ID @copyResultStage.tournament.id(id), %s1.STATUS @copyResultStage.status, %s1.COPY_RESULT_STAGE_ID @copyResultStage.copyResultStage.id(id) }
         {? :groups(call=toInit) | , %g.ID @groups.id(id), %g.NAME @groups.name, %g.STAGE_ID @groups.stage.id }
         {? :playOffGames(call=toInit) | , %p.ID @playOffGames.id(id), %p.HOME_PARTICIPANT_ID @playOffGames.homeParticipant.id, %p.AWAY_PARTICIPANT_ID @playOffGames.awayParticipant.id, %p.STATUS @playOffGames.status, %p.RESULT @playOffGames.result(type=result), %p.STAGE_ID @playOffGames.stage.id, %p.POSITION @playOffGames.position }
         {? :tournament(call=toInit) | , %t.NAME @tournament.name, %t.STATUS @tournament.status, %t.PLAYING_FORMAT_ID @tournament.playingFormat.id, %t.COUNTRY @tournament.country, %t.CITY @tournament.city, %t.ADDRESS @tournament.address, %t.LOGO @tournament.logo, %t.REGISTRATION_FROM @tournament.registrationFrom(type=localdatetime), %t.TOURNAMENT_DATE @tournament.tournamentDate(type=localdate), %t.REGISTRATION_TO @tournament.registrationTo(type=localdatetime), %t.VISIBLE @tournament.visible }
  from %%stage s
  {? :copyResultStage(call=toInit) | left join %%stage s1 on %s.COPY_RESULT_STAGE_ID = %s1.ID }
  {? :groups(call=toInit) | left join %%groups g on %s.ID = %g.STAGE_ID }
  {? :playOffGames(call=toInit) | left join %%play_off_game p on %s.ID = %p.STAGE_ID }
  {? :tournament(call=toInit) | left join %%tournament t on %s.TOURNAMENT_ID = %t.ID }
  {= where
    {& %s.ID ::= :id }
    {& %s.NAME ::= :name }
    {& %s.SEQUENCE ::= :sequence }
    {& %s.NUMBER_OF_HOCKEY ::= :numberOfHockey }
    {& %s.WIN_POINTS ::= :winPoints }
    {& %s.TYPE ::= :type }
    {& %s.TOURNAMENT_ID ::= :tournament.id }
    {& %s.STATUS ::= :status }
    {& %s.COPY_RESULT_STAGE_ID ::= :copyResultStage.id }
  }
;

UPDATE_STAGE(CRUD,in=Stage,out=Stage,tab=stage)=
  update %%stage
  {= set
    { ,%NAME = :name(call=isDef) }
    { ,%SEQUENCE = :sequence(call=isDef) }
    { ,%NUMBER_OF_HOCKEY = :numberOfHockey(call=isDef) }
    { ,%WIN_POINTS = :winPoints(call=isDef) }
    { ,%TYPE = :type(call=isDef) }
    { ,%TOURNAMENT_ID = :tournament.id(call=isDef) }
    { ,%STATUS = :status(call=isDef) }
    { ,%COPY_RESULT_STAGE_ID = :copyResultStage.id(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_STAGE(CRUD,in=Stage,out=Stage,tab=stage)=
  delete from %%stage
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_STAGE(QRY,in=Stage,out=Stage,tab=stage=s,tab=stage=s1,tab=groups=g,tab=playOffGame=p,tab=tournament=t)=
  select {? :onlyIds_ | %s.ID @id(id) |
    %s.ID @id(id), %s.NAME @name, %s.SEQUENCE @sequence, %s.NUMBER_OF_HOCKEY @numberOfHockey, %s.WIN_POINTS @winPoints, %s.TYPE @type, %s.TOURNAMENT_ID @tournament.id(id), %s.STATUS @status, %s.COPY_RESULT_STAGE_ID @copyResultStage.id(id)
    {? :copyResultStage(call=toInit) | , %s1.NAME @copyResultStage.name, %s1.SEQUENCE @copyResultStage.sequence, %s1.NUMBER_OF_HOCKEY @copyResultStage.numberOfHockey, %s1.WIN_POINTS @copyResultStage.winPoints, %s1.TYPE @copyResultStage.type, %s1.TOURNAMENT_ID @copyResultStage.tournament.id(id), %s1.STATUS @copyResultStage.status, %s1.COPY_RESULT_STAGE_ID @copyResultStage.copyResultStage.id(id) }
    {? :groups(call=toInit) | , %g.ID @groups.id(id), %g.NAME @groups.name, %g.STAGE_ID @groups.stage.id }
    {? :playOffGames(call=toInit) | , %p.ID @playOffGames.id(id), %p.HOME_PARTICIPANT_ID @playOffGames.homeParticipant.id, %p.AWAY_PARTICIPANT_ID @playOffGames.awayParticipant.id, %p.STATUS @playOffGames.status, %p.RESULT @playOffGames.result(type=result), %p.STAGE_ID @playOffGames.stage.id, %p.POSITION @playOffGames.position }
    {? :tournament(call=toInit) | , %t.NAME @tournament.name, %t.STATUS @tournament.status, %t.PLAYING_FORMAT_ID @tournament.playingFormat.id, %t.COUNTRY @tournament.country, %t.CITY @tournament.city, %t.ADDRESS @tournament.address, %t.LOGO @tournament.logo, %t.REGISTRATION_FROM @tournament.registrationFrom(type=localdatetime), %t.TOURNAMENT_DATE @tournament.tournamentDate(type=localdate), %t.REGISTRATION_TO @tournament.registrationTo(type=localdatetime), %t.VISIBLE @tournament.visible }
  }
  from %%stage s
  {? :copyResultStage(call=toInit) | left join %%stage s1 on %s.COPY_RESULT_STAGE_ID = %s1.ID }
  {? :groups(call=toInit) | left join %%groups g on %s.ID = %g.STAGE_ID }
  {? :playOffGames(call=toInit) | left join %%play_off_game p on %s.ID = %p.STAGE_ID }
  {? :tournament(call=toInit) | left join %%tournament t on %s.TOURNAMENT_ID = %t.ID }
  {= where
    {& %s.ID ::= :id }
    {& UPPER(%s.NAME) like :+name }
    {& %s.SEQUENCE ::= :sequence }
    {& %s.NUMBER_OF_HOCKEY ::= :numberOfHockey }
    {& %s.WIN_POINTS ::= :winPoints }
    {& UPPER(%s.TYPE) like :+type }
    {& %s.TOURNAMENT_ID ::= :tournament.id }
    {& UPPER(%s.STATUS) like :+status }
    {& %s.COPY_RESULT_STAGE_ID ::= :copyResultStage.id }
    {& %s.ID in :ids_ }
  }
  {#ID order by %s.ID }
  {#NAME order by %s.NAME }
  {#TOURNAMENT order by %s.TOURNAMENT_ID }
  {#COPY_RESULT_STAGE order by %s.COPY_RESULT_STAGE_ID }
;

INSERT_TOURNAMENT(CRUD,in=Tournament,out=Tournament,tab=tournament)=
  insert into %%tournament (%ID, %NAME, %STATUS, %PLAYING_FORMAT_ID, %COUNTRY, %CITY, %ADDRESS, %LOGO, %REGISTRATION_FROM, %TOURNAMENT_DATE, %REGISTRATION_TO, %VISIBLE)
  {= values (:id(seq=TOURNAMENT), :name, :status, :playingFormat.id, :country, :city, :address, :logo, :registrationFrom(type=localdatetime), :tournamentDate(type=localdate), :registrationTo(type=localdatetime), :visible) }
;

GET_TOURNAMENT(CRUD,in=Tournament,out=Tournament,tab=tournament=t,tab=tournamentAdmin=t1,tab=user=u,tab=participant=p1,tab=playingFormat=p,tab=stage=s)=
  select %t.ID @id(id), %t.NAME @name, %t.STATUS @status, %t.PLAYING_FORMAT_ID @playingFormat.id(id), %t.COUNTRY @country, %t.CITY @city, %t.ADDRESS @address, %t.LOGO @logo, %t.REGISTRATION_FROM @registrationFrom(type=localdatetime), %t.TOURNAMENT_DATE @tournamentDate(type=localdate), %t.REGISTRATION_TO @registrationTo(type=localdatetime), %t.VISIBLE @visible
         {? :admin(call=toInit) | , %u.PLAYER_ID @admin.id(id), %u.EMAIL @admin.email, %u.LOGIN @admin.login, %u.PASSWORD @admin.password, %u.PHONE @admin.phone, %u.ROLE @admin.role, %u.VALIDITY @admin.validity }
         {? :participants(call=toInit) | , %p1.ID @participants.id(id), %p1.TOURNAMENT_ID @participants.tournament.id, %p1.PLAYER_ID @participants.player.id }
         {? :playingFormat(call=toInit) | , %p.NAME @playingFormat.name, %p.FINAL_PROMOTING @playingFormat.finalPromoting, %p.LOWER_PROMOTING @playingFormat.lowerPromoting, %p.WIN_POINTS @playingFormat.winPoints, %p.PLAY_OFF_FINAL @playingFormat.playOffFinal, %p.PLAY_OFF_LOWER @playingFormat.playOffLower, %p.MIN_PLAYERS_IN_GROUP @playingFormat.minPlayersInGroup, %p.SORT_TYPE @playingFormat.sortType, %p.DESCRIPTION @playingFormat.description }
         {? :stages(call=toInit) | , %s.ID @stages.id(id), %s.NAME @stages.name, %s.SEQUENCE @stages.sequence, %s.NUMBER_OF_HOCKEY @stages.numberOfHockey, %s.WIN_POINTS @stages.winPoints, %s.TYPE @stages.type, %s.TOURNAMENT_ID @stages.tournament.id, %s.STATUS @stages.status, %s.COPY_RESULT_STAGE_ID @stages.copyResultStage.id }
  from %%tournament t
  {? :admin(call=toInit) | left join %%tournament_admin t1 on %t.ID = %t1.TOURNAMENT_ID left join %%user u on %t1.USER_ID = %u.PLAYER_ID }
  {? :participants(call=toInit) | left join %%participant p1 on %t.ID = %p1.TOURNAMENT_ID }
  {? :playingFormat(call=toInit) | left join %%playing_format p on %t.PLAYING_FORMAT_ID = %p.ID }
  {? :stages(call=toInit) | left join %%stage s on %t.ID = %s.TOURNAMENT_ID }
  {= where
    {& %t.ID ::= :id }
    {& %t.NAME ::= :name }
    {& %t.STATUS ::= :status }
    {& %t.PLAYING_FORMAT_ID ::= :playingFormat.id }
    {& %t.COUNTRY ::= :country }
    {& %t.CITY ::= :city }
    {& %t.ADDRESS ::= :address }
    {& %t.LOGO ::= :logo }
    {& %t.REGISTRATION_FROM ::= :registrationFrom(type=localdatetime) }
    {& %t.TOURNAMENT_DATE ::= :tournamentDate(type=localdate) }
    {& %t.REGISTRATION_TO ::= :registrationTo(type=localdatetime) }
    {& %t.VISIBLE ::= :visible }
  }
;

UPDATE_TOURNAMENT(CRUD,in=Tournament,out=Tournament,tab=tournament)=
  update %%tournament
  {= set
    { ,%NAME = :name(call=isDef) }
    { ,%STATUS = :status(call=isDef) }
    { ,%PLAYING_FORMAT_ID = :playingFormat.id(call=isDef) }
    { ,%COUNTRY = :country(call=isDef) }
    { ,%CITY = :city(call=isDef) }
    { ,%ADDRESS = :address(call=isDef) }
    { ,%LOGO = :logo(call=isDef) }
    { ,%REGISTRATION_FROM = :registrationFrom(type=localdatetime,call=isDef) }
    { ,%TOURNAMENT_DATE = :tournamentDate(type=localdate,call=isDef) }
    { ,%REGISTRATION_TO = :registrationTo(type=localdatetime,call=isDef) }
    { ,%VISIBLE = :visible(call=isDef) }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_TOURNAMENT(CRUD,in=Tournament,out=Tournament,tab=tournament)=
  delete from %%tournament
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_TOURNAMENT(QRY,in=Tournament,out=Tournament,tab=tournament=t,tab=tournamentAdmin=t1,tab=user=u,tab=participant=p1,tab=playingFormat=p,tab=stage=s)=
  select {? :onlyIds_ | %t.ID @id(id) |
    %t.ID @id(id), %t.NAME @name, %t.STATUS @status, %t.PLAYING_FORMAT_ID @playingFormat.id(id), %t.COUNTRY @country, %t.CITY @city, %t.ADDRESS @address, %t.LOGO @logo, %t.REGISTRATION_FROM @registrationFrom(type=localdatetime), %t.TOURNAMENT_DATE @tournamentDate(type=localdate), %t.REGISTRATION_TO @registrationTo(type=localdatetime), %t.VISIBLE @visible
    {? :admin(call=toInit) | , %u.PLAYER_ID @admin.id(id), %u.EMAIL @admin.email, %u.LOGIN @admin.login, %u.PASSWORD @admin.password, %u.PHONE @admin.phone, %u.ROLE @admin.role, %u.VALIDITY @admin.validity }
    {? :participants(call=toInit) | , %p1.ID @participants.id(id), %p1.TOURNAMENT_ID @participants.tournament.id, %p1.PLAYER_ID @participants.player.id }
    {? :playingFormat(call=toInit) | , %p.NAME @playingFormat.name, %p.FINAL_PROMOTING @playingFormat.finalPromoting, %p.LOWER_PROMOTING @playingFormat.lowerPromoting, %p.WIN_POINTS @playingFormat.winPoints, %p.PLAY_OFF_FINAL @playingFormat.playOffFinal, %p.PLAY_OFF_LOWER @playingFormat.playOffLower, %p.MIN_PLAYERS_IN_GROUP @playingFormat.minPlayersInGroup, %p.SORT_TYPE @playingFormat.sortType, %p.DESCRIPTION @playingFormat.description }
    {? :stages(call=toInit) | , %s.ID @stages.id(id), %s.NAME @stages.name, %s.SEQUENCE @stages.sequence, %s.NUMBER_OF_HOCKEY @stages.numberOfHockey, %s.WIN_POINTS @stages.winPoints, %s.TYPE @stages.type, %s.TOURNAMENT_ID @stages.tournament.id, %s.STATUS @stages.status, %s.COPY_RESULT_STAGE_ID @stages.copyResultStage.id }
  }
  from %%tournament t
  {? :admin(call=toInit) | left join %%tournament_admin t1 on %t.ID = %t1.TOURNAMENT_ID left join %%user u on %t1.USER_ID = %u.PLAYER_ID }
  {? :participants(call=toInit) | left join %%participant p1 on %t.ID = %p1.TOURNAMENT_ID }
  {? :playingFormat(call=toInit) | left join %%playing_format p on %t.PLAYING_FORMAT_ID = %p.ID }
  {? :stages(call=toInit) | left join %%stage s on %t.ID = %s.TOURNAMENT_ID }
  {= where
    {& %t.ID ::= :id }
    {& UPPER(%t.NAME) like :+name }
    {& UPPER(%t.STATUS) like :+status }
    {& %t.PLAYING_FORMAT_ID ::= :playingFormat.id }
    {& UPPER(%t.COUNTRY) like :+country }
    {& UPPER(%t.CITY) like :+city }
    {& UPPER(%t.ADDRESS) like :+address }
    {& %t.LOGO ::= :logo }
    {& %t.REGISTRATION_FROM ::= :registrationFrom(type=localdatetime) }
    {& %t.TOURNAMENT_DATE ::= :tournamentDate(type=localdate) }
    {& %t.REGISTRATION_TO ::= :registrationTo(type=localdatetime) }
    {& %t.VISIBLE ::= :visible }
    {& %t.ID in :ids_ }
  }
  {#ID order by %t.ID }
  {#PLAYING_FORMAT order by %t.PLAYING_FORMAT_ID }
;

INSERT_TOURNAMENT_ADMIN(CRUD,in=TournamentAdmin,out=TournamentAdmin,tab=tournamentAdmin)=
  insert into %%tournament_admin (%ID, %TOURNAMENT_ID, %USER_ID)
  {= values (:id(seq=TOURNAMENT_ADMIN), :tournamentId, :userId) }
;

GET_TOURNAMENT_ADMIN(CRUD,in=TournamentAdmin,out=TournamentAdmin,tab=tournamentAdmin)=
  select %ID @id(id), %TOURNAMENT_ID @tournamentId, %USER_ID @userId
  from %%tournament_admin
  {= where
    {& %ID ::= :id }
    {& %TOURNAMENT_ID ::= :tournamentId }
    {& %USER_ID ::= :userId }
  }
;

UPDATE_TOURNAMENT_ADMIN(CRUD,in=TournamentAdmin,out=TournamentAdmin,tab=tournamentAdmin)=
  update %%tournament_admin
  {= set
    { ,%TOURNAMENT_ID = :tournamentId }
    { ,%USER_ID = :userId }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_TOURNAMENT_ADMIN(CRUD,in=TournamentAdmin,out=TournamentAdmin,tab=tournamentAdmin)=
  delete from %%tournament_admin
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_TOURNAMENT_ADMIN(QRY,in=TournamentAdmin,out=TournamentAdmin,tab=tournamentAdmin)=
  select {? :onlyIds_ | %ID @id(id) |
    %ID @id(id), %TOURNAMENT_ID @tournamentId, %USER_ID @userId
  }
  from %%tournament_admin
  {= where
    {& %ID ::= :id }
    {& %TOURNAMENT_ID ::= :tournamentId }
    {& %USER_ID ::= :userId }
    {& %ID in :ids_ }
  }
  {#ID order by %ID }
  {#TOURNAMENT_ID order by %TOURNAMENT_ID }
  {#USER_ID order by %USER_ID }
;

INSERT_TOURNAMENT_RATING(CRUD,in=TournamentRating,out=TournamentRating,tab=tournamentRating)=
  insert into %%tournament_rating (%ID, %TOURNAMENT_ID, %RATING_ID)
  {= values (:id(seq=TOURNAMENT_RATING), :tournamentId, :ratingId) }
;

GET_TOURNAMENT_RATING(CRUD,in=TournamentRating,out=TournamentRating,tab=tournamentRating)=
  select %ID @id(id), %TOURNAMENT_ID @tournamentId, %RATING_ID @ratingId
  from %%tournament_rating
  {= where
    {& %ID ::= :id }
    {& %TOURNAMENT_ID ::= :tournamentId }
    {& %RATING_ID ::= :ratingId }
  }
;

UPDATE_TOURNAMENT_RATING(CRUD,in=TournamentRating,out=TournamentRating,tab=tournamentRating)=
  update %%tournament_rating
  {= set
    { ,%TOURNAMENT_ID = :tournamentId }
    { ,%RATING_ID = :ratingId }
  }
  {= where
    {& %ID = :id(!empty) }
  }
;

DELETE_TOURNAMENT_RATING(CRUD,in=TournamentRating,out=TournamentRating,tab=tournamentRating)=
  delete from %%tournament_rating
  {= where
    {& %ID = :id(!empty) }
  }
;

SELECT_TOURNAMENT_RATING(QRY,in=TournamentRating,out=TournamentRating,tab=tournamentRating)=
  select {? :onlyIds_ | %ID @id(id) |
    %ID @id(id), %TOURNAMENT_ID @tournamentId, %RATING_ID @ratingId
  }
  from %%tournament_rating
  {= where
    {& %ID ::= :id }
    {& %TOURNAMENT_ID ::= :tournamentId }
    {& %RATING_ID ::= :ratingId }
    {& %ID in :ids_ }
  }
  {#ID order by %ID }
  {#TOURNAMENT_ID order by %TOURNAMENT_ID }
  {#RATING_ID order by %RATING_ID }
;

INSERT_USER(CRUD,in=User,out=User,tab=user)=
  insert into %%user (%PLAYER_ID, %EMAIL, %LOGIN, %PASSWORD, %PHONE, %ROLE, %VALIDITY)
  {= values (:id, :email, :login, :password, :phone, :role, :validity) }
;

GET_USER(CRUD,in=User,out=User,tab=user=u,tab=player=p,tab=tournamentAdmin=t,tab=tournament=t1,tab=ithfTournament=i,tab=matchs=m,tab=participant=p1)=
  select %u.PLAYER_ID @id(id), %u.EMAIL @email, %u.LOGIN @login, %u.PASSWORD @password, %u.PHONE @phone, %u.ROLE @role, %u.VALIDITY @validity
         , %p.NAME @name, %p.SURNAME @surname(type=surname), %p.NICKNAME @nickname, %p.GENDER @gender, %p.DATE_OF_BIRTH @dateOfBirth(type=localdate), %p.COUNTRY @country, %p.CITY @city, %p.CLUB @club, %p.WORLD_RANKING @worldRanking, %p.ITHF_ID @ithfId, %p.NAME_ASCII @nameAscii, %p.SURNAME_ASCII @surnameAscii, %p.VERIFICATION @verification
         {? :administeredTournament(call=toInit) | , %t1.ID @administeredTournament.id(id), %t1.NAME @administeredTournament.name, %t1.STATUS @administeredTournament.status, %t1.PLAYING_FORMAT_ID @administeredTournament.playingFormat.id, %t1.COUNTRY @administeredTournament.country, %t1.CITY @administeredTournament.city, %t1.ADDRESS @administeredTournament.address, %t1.LOGO @administeredTournament.logo, %t1.REGISTRATION_FROM @administeredTournament.registrationFrom(type=localdatetime), %t1.TOURNAMENT_DATE @administeredTournament.tournamentDate(type=localdate), %t1.REGISTRATION_TO @administeredTournament.registrationTo(type=localdatetime), %t1.VISIBLE @administeredTournament.visible }
         {? :ithfTournaments(call=toInit) | , %i.ID @ithfTournaments.id(id), %i.PLAYER_ID @ithfTournaments.player.id, %i.NAME @ithfTournaments.name, %i.SERIES @ithfTournaments.series(type=series), %i.DATE @ithfTournaments.date(type=localdate), %i.POINTS @ithfTournaments.points, %i.RANK @ithfTournaments.rank }
         {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
         {? :participants(call=toInit) | , %p1.ID @participants.id(id), %p1.TOURNAMENT_ID @participants.tournament.id, %p1.PLAYER_ID @participants.player.id }
  from %%user u
  join %%player p on %u.PLAYER_ID = %p.ID
  {? :administeredTournament(call=toInit) | left join %%tournament_admin t on %u.PLAYER_ID = %t.USER_ID left join %%tournament t1 on %t.TOURNAMENT_ID = %t1.ID }
  {? :ithfTournaments(call=toInit) | left join %%ithf_tournament i on %p.ID = %i.PLAYER_ID }
  {? :matchs(call=toInit) | left join %%matchs m on %p.ID = %m.AWAY_PLAYER_ID }
  {? :participants(call=toInit) | left join %%participant p1 on %p.ID = %p1.PLAYER_ID }
  {= where
    {& %u.PLAYER_ID ::= :id }
    {& %u.EMAIL ::= :email }
    {& %u.LOGIN ::= :login }
    {& %u.PASSWORD ::= :password }
    {& %u.PHONE ::= :phone }
    {& %u.ROLE ::= :role }
    {& %u.VALIDITY ::= :validity }
    {& %p.NAME ::= :name }
    {& %p.SURNAME ::= :surname(type=surname) }
    {& %p.NICKNAME ::= :nickname }
    {& %p.GENDER ::= :gender }
    {& %p.DATE_OF_BIRTH ::= :dateOfBirth(type=localdate) }
    {& %p.COUNTRY ::= :country }
    {& %p.CITY ::= :city }
    {& %p.CLUB ::= :club }
    {& %p.WORLD_RANKING ::= :worldRanking }
    {& %p.ITHF_ID ::= :ithfId }
    {& %p.NAME_ASCII ::= :nameAscii }
    {& %p.SURNAME_ASCII ::= :surnameAscii }
    {& %p.VERIFICATION ::= :verification }
  }
;

UPDATE_USER(CRUD,in=User,out=User,tab=user)=
  update %%user
  {= set
    { ,%EMAIL = :email(call=isDef) }
    { ,%LOGIN = :login(call=isDef) }
    { ,%PASSWORD = :password(call=isDef) }
    { ,%PHONE = :phone(call=isDef) }
    { ,%ROLE = :role(call=isDef) }
    { ,%VALIDITY = :validity(call=isDef) }
  }
  {= where
    {& %PLAYER_ID = :id(!empty) }
  }
;

DELETE_USER(CRUD,in=User,out=User,tab=user)=
  delete from %%user
  {= where
    {& %PLAYER_ID = :id(!empty) }
  }
;

SELECT_USER(QRY,in=User,out=User,tab=user=u,tab=player=p,tab=tournamentAdmin=t,tab=tournament=t1,tab=ithfTournament=i,tab=matchs=m,tab=participant=p1)=
  select {? :onlyIds_ | %u.PLAYER_ID @id(id) |
    %u.PLAYER_ID @id(id), %u.EMAIL @email, %u.LOGIN @login, %u.PASSWORD @password, %u.PHONE @phone, %u.ROLE @role, %u.VALIDITY @validity
    , %p.NAME @name, %p.SURNAME @surname(type=surname), %p.NICKNAME @nickname, %p.GENDER @gender, %p.DATE_OF_BIRTH @dateOfBirth(type=localdate), %p.COUNTRY @country, %p.CITY @city, %p.CLUB @club, %p.WORLD_RANKING @worldRanking, %p.ITHF_ID @ithfId, %p.NAME_ASCII @nameAscii, %p.SURNAME_ASCII @surnameAscii, %p.VERIFICATION @verification
    {? :administeredTournament(call=toInit) | , %t1.ID @administeredTournament.id(id), %t1.NAME @administeredTournament.name, %t1.STATUS @administeredTournament.status, %t1.PLAYING_FORMAT_ID @administeredTournament.playingFormat.id, %t1.COUNTRY @administeredTournament.country, %t1.CITY @administeredTournament.city, %t1.ADDRESS @administeredTournament.address, %t1.LOGO @administeredTournament.logo, %t1.REGISTRATION_FROM @administeredTournament.registrationFrom(type=localdatetime), %t1.TOURNAMENT_DATE @administeredTournament.tournamentDate(type=localdate), %t1.REGISTRATION_TO @administeredTournament.registrationTo(type=localdatetime), %t1.VISIBLE @administeredTournament.visible }
    {? :ithfTournaments(call=toInit) | , %i.ID @ithfTournaments.id(id), %i.PLAYER_ID @ithfTournaments.player.id, %i.NAME @ithfTournaments.name, %i.SERIES @ithfTournaments.series(type=series), %i.DATE @ithfTournaments.date(type=localdate), %i.POINTS @ithfTournaments.points, %i.RANK @ithfTournaments.rank }
    {? :matchs(call=toInit) | , %m.ID @matchs.id(id), %m.HOME_PLAYER_ID @matchs.homePlayer.id, %m.AWAY_PLAYER_ID @matchs.awayPlayer.id, %m.GAME_ID @matchs.game.id, %m.GROUP_ID @matchs.group.id, %m.ROUND @matchs.round, %m.HOCKEY @matchs.hockey }
    {? :participants(call=toInit) | , %p1.ID @participants.id(id), %p1.TOURNAMENT_ID @participants.tournament.id, %p1.PLAYER_ID @participants.player.id }
  }
  from %%user u
  join %%player p on %u.PLAYER_ID = %p.ID
  {? :administeredTournament(call=toInit) | left join %%tournament_admin t on %u.PLAYER_ID = %t.USER_ID left join %%tournament t1 on %t.TOURNAMENT_ID = %t1.ID }
  {? :ithfTournaments(call=toInit) | left join %%ithf_tournament i on %p.ID = %i.PLAYER_ID }
  {? :matchs(call=toInit) | left join %%matchs m on %p.ID = %m.AWAY_PLAYER_ID }
  {? :participants(call=toInit) | left join %%participant p1 on %p.ID = %p1.PLAYER_ID }
  {= where
    {& %u.PLAYER_ID ::= :id }
    {& UPPER(%u.EMAIL) like :+email }
    {& UPPER(%u.LOGIN) like :+login }
    {& UPPER(%u.PASSWORD) like :+password }
    {& UPPER(%u.PHONE) like :+phone }
    {& UPPER(%u.ROLE) like :+role }
    {& %u.VALIDITY ::= :validity }
    {& UPPER(%p.NAME) like :+name }
    {& %p.SURNAME ::= :surname(type=surname) }
    {& UPPER(%p.NICKNAME) like :+nickname }
    {& UPPER(%p.GENDER) like :+gender }
    {& %p.DATE_OF_BIRTH ::= :dateOfBirth(type=localdate) }
    {& UPPER(%p.COUNTRY) like :+country }
    {& UPPER(%p.CITY) like :+city }
    {& UPPER(%p.CLUB) like :+club }
    {& %p.WORLD_RANKING ::= :worldRanking }
    {& %p.ITHF_ID ::= :ithfId }
    {& UPPER(%p.NAME_ASCII) like :+nameAscii }
    {& UPPER(%p.SURNAME_ASCII) like :+surnameAscii }
    {& %p.VERIFICATION ::= :verification }
    {& %u.PLAYER_ID in :ids_ }
  }
  {#ID order by %u.PLAYER_ID }
  {#EMAIL order by %u.EMAIL }
  {#LOGIN order by %u.LOGIN }
;
